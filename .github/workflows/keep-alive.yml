name: Keep Server Alive

on:
  schedule:
    # Runs every 10 minutes during 6 AM - 10 PM CST (12:00 - 03:59 UTC)
    # CST is UTC-6, so:
    #   6 AM CST = 12:00 UTC
    #   10 PM CST = 04:00 UTC (next day)
    # Hours 12-23 (same day) and 0-3 (next day)
    - cron: '*/10 12-23,0-3 * * *'

  # Allow manual trigger for testing
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping server
        run: |
          echo "Pinging server at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" https://toric-scope-backend.onrender.com/api/health)

          if [ $response -eq 200 ]; then
            echo "✓ Server is alive (HTTP $response)"
          else
            echo "⚠ Server returned HTTP $response"
            exit 1
          fi

      - name: Log response
        if: always()
        run: |
          echo "Ping completed at $(date)"
          echo "Timezone: $(date -u) UTC"
